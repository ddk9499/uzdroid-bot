# Sample telegram bot

### put your configuration values [bot.json](https://github.com/ddk9499/uzdroid-bot/blob/adkhambek/app/src/main/resources/bot.json)


# Database config

```sql
-- ////////////////////////////////////////////////////////////////////
-- //   Captcha TABLE
-- ////////////////////////////////////////////////////////////////////
CREATE TABLE IF NOT EXISTS public.captcha
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY,
    created_at  TIMESTAMP   NOT NULL DEFAULT NOW(),
    modified_at TIMESTAMP   NOT NULL DEFAULT NOW(),

    user_id     BIGINT      NOT NULL,
    message_id  BIGINT      NOT NULL,
    captcha     VARCHAR(24) NOT NULL,

    CONSTRAINT pk_ucaptcha PRIMARY KEY (id),
    CONSTRAINT uk_captcha UNIQUE (user_id, message_id, captcha)
);

-- ////////////////////////////////////////////////////////////////////
-- //   NOTIFY TRIGGER FOR BROADCASTING
-- ////////////////////////////////////////////////////////////////////
CREATE OR REPLACE FUNCTION update_modified_column()
    RETURNS TRIGGER AS
$$
BEGIN
    NEW.modified_at = now();
    RETURN NEW;
END;
$$ LANGUAGE 'plpgsql';

CREATE TRIGGER update_captcha_modified
    BEFORE UPDATE
    ON public.captcha
    FOR EACH ROW
EXECUTE PROCEDURE update_modified_column();

-- ////////////////////////////////////////////////////////////////////
-- //   GENERATE Captcha
-- ////////////////////////////////////////////////////////////////////
CREATE OR REPLACE FUNCTION public.generate_captcha(
    v_user_id BIGINT,
    v_message_id BIGINT,
    v_captcha VARCHAR(24)
)
    LANGUAGE plpgsql AS
$$
BEGIN
    DELETE
    FROM public.captcha
    WHERE public.captcha.user_id = v_user_id;

    INSERT INTO public.captcha (user_id, message_id, captcha)
    VALUES (v_user_id, v_message_id, v_captcha);
END;
$$;
```
